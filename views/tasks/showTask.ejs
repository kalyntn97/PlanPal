<%- include('../partials/html-head.ejs') %>
<%- include('../partials/nav.ejs') %>

<h1>Task <%= task.name %> Details </h1>
<%# Edit the task %>
<% if (task.creator.equals(user?.profile._id)) { %>
  <a href='/plans/<%= plan._id %>/tasks/<%= task._id %>/editTask'>
    <button class='mainBtn'>Edit Task</button>
  </a>
<% } %>
<%# Show the task %>
<h3>
  Name: <%= task.name %>
  Date: <%= task.date %>
  Creator: <%= task.creator.name %>
  Status: <%= task.status %>
  Notes: <%= task.notes %>
</h3>

<%# Comments Section %>
<% if (user) { %>
  <form class="commentForm" id="taskCommentForm" action="/plans/<%= plan._id %>/tasks/<%= task._id %>/comments" method="POST">
    <textarea name="content"></textarea>
    <button class='mainBtn' type="submit">Add Comment</button>
  </form>
<% } %>

<%# Show all comments %>
<h2>ğŸ’¬ <%= task.comments.length %> Comments</h2>
<ul>
  <% task.comments.forEach(comment => { %>
    <li>
      <%= comment.author.name %> - <%= comment.content %>
    </li>
  <% }) %>
</ul>

<%- include('../partials/footer.ejs') %>